#ifdef GL_ES
precision highp float;
#endif

uniform float time;
uniform vec2 resolution;
uniform vec4 mouse;
vec3 cr[36] = 
{
{1,1,1},
{0.4535961214255773,-0.2272020946930871,0.16996714290024104},
{-0.5885011172553458,-0.896758416334147,-0.9422223406686581},
{-0.9874797699088649,0.6346928759426347,-0.4902608213407002},
{-0.30733286997841935,0.6083513145322546,0.7755658785102496},
{0.70866977429126,-0.9111302618846769,0.7539022543433046},
{0.9502325919585293,-0.1943299064553348,-0.5192886541166841},
{0.15337386203786346,0.9994345855010047,-0.9304262721047539},
{-0.811093014061656,-0.25981735621375585,0.2030048638187504},
{-0.8891911526253609,-0.8813724903622346,0.9994345855010047},
{0.004425697988050785,0.6603167082440802,0.1367372182078336},
{0.8932061115093233,0.5813218118144357,-0.9529529168871798},
{0.8058839576404497,-0.9244717749141217,-0.4606785874113657},
{-0.16211443649971827,-0.16123796432418536,0.7963524702919231},
{-0.9529529168871809,0.9977389813911304,0.7313860956454992},
{-0.7023970575027135,-0.2921388087338362,-0.5477292602242684},
{0.31574375491924334,-0.8649898828201886,-0.9175780505318613},
{0.9888373426941465,0.6851938352639869,0.23581302095051915},
{0.5813218118144357,0.553634933534655,0.9977389813911304},
{-0.46146670441591253,-0.9367678684526696,0.1033526671039744},
{-0.9999608263946371,-0.12796368962740468,-0.9626058663135666},
{-0.44569000044433316,0.994915105108673,-0.43057540477663},
{0.5956343152752115,-0.3241299022175636,0.8162385236075683},
{0.9860448308379632,-0.8476291196356829,0.7080428643420107},
{0.2988979063644682,0.7092961252257328,-0.5755504782013374},
{-0.7148869687796676,0.5253219888177297,-0.9036922050915067},
{-0.9474378189567576,-0.9480046377211855,0.26835451388009673},
{-0.14462127116171977,-0.09454470987969996,0.9949151051086736},
{0.8162385236075724,0.990966149974821,0.06985124180713438},
{0.8851065280947882,-0.35575446020874757,-0.9711702731126886},
{-0.013276747223059479,-0.8293098328631502,-0.39998531498835127},
{-0.897151090185845,0.7325963225609111,0.8352015507314431},
{-0.8006117624589936,0.4964149947625673,0.6838989576357016},
{0.17084230974765666,-0.9581693758551346,-0.6027208470078549},
{0.9555985806128415,-0.061018816232456675,-0.88878443830038},
{0.6960693098638897,0.9858965815825497,0.3005925437436371}
};

float e(vec3 c)
{
    c=cos(vec3(cos(c.r+time/6.0)*c.r-cos(c.g*3.0+time/5.0)*c.g, cos(time/4.0)*c.b/3.0*c.r-cos(time/7.0)*c.g, c.r+c.g+c.b+time));
    return dot(c*c,vec3(1.0))-1.0;
}

void main(void)
{
    vec2 c=-1.0+2.0*gl_FragCoord.rg/resolution.xy;
    vec3 o=vec3(c.r,c.g,0.0),g=vec3(c.r,c.g,1.0)/64.0,v=vec3(0.5);
    float m = 0.4;
//    float m = 1.0-1.5*mouse.x/resolution.x;
    for(int r=0;r<30;r++)
    {
      float h=e(o)-m;
      if(h<0.0)break;
      o+=h*10.0*g;
      v+=h*0.02;
    }
    // light (who needs a normal?)
    v+=e(o+0.1)*vec3(0.4,0.7,1.0);

    // ambient occlusion
    float a=0.0;
    for(int r=0;r<36;r++)
       a+=clamp(4.0*(e(o+0.5*vec3(cr[r].x,cr[r].y,cr[r].z))-m),0.0,1.0);
    v*=a/100.0;
    gl_FragColor=vec4(v,1.0);
}
